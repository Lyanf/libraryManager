<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Log in</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="/bower_components/Ionicons/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/dist/css/AdminLTE.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="/plugins/iCheck/square/blue.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Google Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head>
<body class="hold-transition login-page">
<div class="login-box">
    <div class="login-logo">
        <a href="/index"><b>图书系统</b>by LYF</a>
    </div>
    <!-- /.login-logo -->
    <div class="login-box-body">
        <p class="login-box-msg">Register to start your session</p>
        <form action="/userSignUp" method="post" onsubmit="return formcheck()">
            <div class="form-group">
                <input type="text" class="form-control" placeholder="用户名"id="ID"  required name="ID">
            </div>
            <div class="form-group">
                <input type="password" class="form-control" placeholder="密码" id="PW" required name="PW">
            </div>
            <div class="form-group">
                <input type="password" class="form-control" placeholder="确认密码" id="PW2" required name="PW2">
            </div>
            <div class="form-group">
                <input type="text" class="form-control" placeholder="姓名" name="userName">
            </div>
            <div id="lyfcxselect" class="form-group">
                <select class="school" name="school">
                </select>
                <select class="major" name="major">
                </select>
            </div>
            <!--<div class="form-group">-->
                <!--<input type="text" class="form-control" placeholder="院系" name="school">-->
            <!--</div>-->
            <!--<div class="form-group">-->
                <!--<input type="text" class="form-control" placeholder="专业" name="major">-->
            <!--</div>-->
            <div class="form-group">
                <input type="text" class="form-control" placeholder="兴趣爱好" name="hobby">
            </div>
            <div class="form-group">
                <input type="date" class="form-control" placeholder="出生日期" id="bornDate" required name="bornDate">
            </div>
            <div class="form-group">
                <input type="number" class="form-control" placeholder="年级" min="1" max="4" step="1" name="grade">
            </div>
            <button type="submit" class="btn btn-primary btn-block btn-flat">Sign up</button>

            <!--<p><label>用户名 * <input type="text" name="ID"></label> </p>-->
            <!--<p><label>密码 * <input type="password" name="PW"></label></p>-->
            <!--<p><label>确认密码 * <input type="password" name="PW2"></label> </p>-->
            <!--<p><label>姓名<input type="text"  name="userName"></label></p>-->
            <!--<p><label>院系<input type="text" name="school"></label></p>-->
            <!--<p><label>专业<input type="text" name="major"></label></p>-->
            <!--<p><label>兴趣爱好<input type="text" name="hobby"></label></p>-->
            <!--<p><label>出生日期<input type="date" name="bornDate"></label></p>-->
            <!--<p><label>年级<input type="number" name="grade"></label></p>-->
            <!--<p><input type="submit" value="注册"></p>-->
        </form>


        <!-- /.social-auth-links -->


    </div>
    <!-- /.login-box-body -->
</div>

<!-- /.login-box -->

<!-- jQuery 3 -->
<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- iCheck -->
<script src="/plugins/iCheck/icheck.min.js"></script>
<script src="jquery.cxselect.js"></script>
<script>
    $(function () {
        $('input').iCheck({
            checkboxClass: 'icheckbox_square-blue',
            radioClass: 'iradio_square-blue',
            increaseArea: '20%' /* optional */
        });
    });
</script>
<script>
    $('#lyfcxselect').cxSelect({
        selects: ['school', 'major'],  // 数组，请注意顺序
        emptyStyle: 'none',
        jsonName:'name',
        jsonValue:'value',
        jsonSub:'sub',
        data:
            [
                {
                    name: '信息院',
                    value: '信息院',
                    sub: [
                        {
                            name: '计算机',
                            value: '计算机'
                        },
                        {
                            name: '信息安全',
                            value: '信息安全'
                        }
                    ]
                },
                {
                    name:'物理院',
                    value:'物理院',
                    sub:[
                        {
                            name:'材料物理',
                            value:'材料物理'
                        },
                        {
                            name:'理论物理',
                            value:'理论物理'
                        }
                    ]
                }
            ]
    });
</script>
<script>
var formcheck = function formCheck() {
    var pw1 = document.getElementById("PW")
    var pw2 = document.getElementById("PW2")
    var id = document.getElementById("ID")
    var date = document.getElementById("bornDate")
    if (pw1.value != pw2.value)
    {
        pw2.setCustomValidity("两次密码不一致！")
        return false
    }
    else{
        pw2.setCustomValidity('')
    }
    if(/.*[a-z]+.*/.test(pw1.value)&&/.*[A-Z]+.*/.test(pw1.value))
    {
        pw1.setCustomValidity('')
    }
    else{
        pw1.setCustomValidity("密码格式错误，必须包括大小写字母才可以")
        return false
    }
    if(/\w+/.test(id.value))
    {
        id.setCustomValidity('')
    }
    else{
        id.setCustomValidity("用户名不能包含特殊字符！")
        return false
    }
    var year = date.value.split('-')[0]
    year = parseInt(year)
    if (year>2001){
        date.setCustomValidity("年龄错误！")
        return false
    }
    else{
        date.setCustomValidity('')
    }
    var successful = true
    $.ajax(
        {
            url:'testid',
            success:function (result) {
                console.log(result)
                if (result=='yes'){

                }
                else{
                    id.setCustomValidity("该用户名已经被注册过了");
                    successful = false
                }
            },
            data: {id:id.value},
            dataType:'text',
            async:false
        }
    );
    if(!successful){
        return false
    }
    return true
}
</script>
<script>
    var pw1 = document.getElementById("PW")
    var pw2 = document.getElementById("PW2")
    var id = document.getElementById("ID")
    var date = document.getElementById("bornDate")
    $('#PW').on('input', function () {
        console.log('setCustomValidity() reset');
        this.setCustomValidity('');
    });
    $('#PW2').on('input', function () {
        console.log('setCustomValidity() reset');
        this.setCustomValidity('');
    });
    $('#ID').on('input', function () {
        console.log('setCustomValidity() reset');
        this.setCustomValidity('');
    });
    $('#bornDate').on('input', function () {
        console.log('setCustomValidity() reset');
        this.setCustomValidity('');
    });
</script>
</body>
</html>
